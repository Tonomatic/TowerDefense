<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
  </head>
  <body>
    <script>
      // var config = {
      //     type: Phaser.AUTO,
      //     width: 800,
      //     height: 600,
      //     physics: {
      //         default: 'arcade',
      //         arcade: {
      //             gravity: { y: 200 }
      //         }
      //     },
      //     scene: {
      //         preload: preload,
      //         create: create
      //     }
      // };

      // var game = new Phaser.Game(config);

      // function preload ()
      // {
      //     this.load.setBaseURL('http://labs.phaser.io');

      //     this.load.image('sky', 'assets/skies/space3.png');
      //     this.load.image('logo', 'assets/sprites/phaser3-logo.png');
      //     this.load.image('red', 'assets/particles/red.png');
      // }

      // function create ()
      // {
      //     this.add.image(400, 300, 'sky');

      //     var particles = this.add.particles('red');

      //     var emitter = particles.createEmitter({
      //         speed: 100,
      //         scale: { start: 1, end: 0 },
      //         blendMode: 'ADD'
      //     });

      //     var logo = this.physics.add.image(400, 100, 'logo');

      //     logo.setVelocity(100, 200);
      //     logo.setBounce(1, 1);
      //     logo.setCollideWorldBounds(true);

      //     emitter.startFollow(logo);
      // }

      var config = {
        type: Phaser.AUTO,
        parent: "content",
        width: 640,
        height: 512,
        scene: {
          key: "main",
          preload: preload,
          create: create,
          update: update,
        },
      };
      var game = new Phaser.Game(config);
      var graphics;
      var path;

      function preload() {
        this.load.atlas("sprites", "./images/circle.png");
        this.load.image("bullet", "images/blue-circle.png");
      }

      var ENEMY_SPEED = 1 / 10000;

      var Enemy = new Phaser.Class({
        Extends: Phaser.GameObjects.Image,

        initialize: function Enemy(scene) {
          Phaser.GameObjects.Image.call(this, scene, 0, 0, "sprites", "enemy");
          this.follower = { t: 0, vec: new Phaser.Math.Vector2() };
        },
        startOnPath: function () {
          this.follower.t = 0;

          path.getPoint(this.follower.t, this.follower.vec);

          this.setPosition(this.follower.vec.x, this.follower.vec.y);
        },
        update: function (time, delta) {
          // move the t point along the path, 0 is the start and 0 is the end
          this.follower.t += ENEMY_SPEED * delta;

          // get the new x and y coordinates in vec
          path.getPoint(this.follower.t, this.follower.vec);

          // update enemy x and y to the newly obtained x and y
          this.setPosition(this.follower.vec.x, this.follower.vec.y);
          // if we have reached the end of the path, remove the enemy
          if (this.follower.t >= 1) {
            this.setActive(false);
            this.setVisible(false);
          }
        },
      });

      function create() {
        // this graphics element is only for visualization,
        // its not related to our path
        var graphics = this.add.graphics();

        // the path for our enemies
        // parameters are the start x and y of our path
        path = this.add.path(96, -32);
        path.lineTo(96, 164);
        path.lineTo(480, 164);
        path.lineTo(480, 544);

        graphics.lineStyle(3, 0xffffff, 1);
        // visualize the path
        path.draw(graphics);
        enemies = this.add.group({ classType: Enemy, runChildUpdate: true });
        this.nextEnemy = 0;
      }

      function update(time, delta) {
        // if its time for the next enemy
        if (time > this.nextEnemy) {
          var enemy = enemies.get();
          if (enemy) {
            enemy.setActive(true);
            enemy.setVisible(true);

            // place the enemy at the start of the path
            enemy.startOnPath();

            this.nextEnemy = time + 2000;
          }
        }
      }
    </script>
  </body>
</html>
